# 混合架构 RAG 智能助手评估规范

## 1. 概述
本文档定义了混合 RAG 智能助手的测试策略、数据集和评估指标。该系统旨在从上传的私有文档和公共互联网中检索信息，并根据用户意图智能地路由查询。

## 2. 测试目标
- **文件解析能力**：验证对多种文件格式上传和索引的支持（.txt, .pdf, .md, .json, .docx）。
- **路由准确性**：确保 Agent 能正确区分需要查询私有数据还是公共互联网搜索的请求。
- **冲突处理**：验证当内部文档与公共信息冲突时，是否遵循“私有优先”原则。
- **信息提取**：评估从上传文档中提取事实的准确性。
- **隐私与安全**：确保敏感的内部代号不会泄露给公共搜索引擎。

## 3. 测试数据集 (黄金语料库)

### 3.1 核心场景：星云科技战略 (NebulaTech Strategy)
一套受控的、高冲突数据集，旨在测试路由和推理能力。
- **文档**: `NebulaTech_Internal_Strategy_2025.txt`
- **关键事实**:
    - 产品: Nebula-X 手机
    - 芯片: N-Chip 9000 (保密) vs. 骁龙 (外界传闻)
    - 价格: 5999 元 (内部)
    - 供应链: 中芯国际 (内部) vs. 台积电 (公关口径)
    - 发布会: 线上直播 (最终决定) vs. 北京 (旧计划)

### 3.2 基础能力：文件格式
简单的文档用于验证解析成功率。
- `test_doc.txt`: 纯文本。
- `test_doc.md`: 带标题的 Markdown。
- `test_doc.json`: 结构化 JSON 数据。
- `test_doc.pdf`: (模拟/实际) PDF 文档。

## 4. 评估指标

| 指标 | 描述 | 目标 | 来源 |
| :--- | :--- | :--- | :--- |
| **路由准确性** | 正确路由到 私有/公网/混合 工具的查询比例 | > 95% | Gemini 方案 |
| **私有事实召回率** | 从私有文档提取事实的准确率 | > 90% | Gemini 方案 |
| **冲突处理** | 私有数据覆盖公网传闻的比例 | 100% | LongMemEval |
| **格式支持** | 不同文件类型内容检索的成功率 | 100% | Excel 测试用例 |
| **隐私泄露率** | 发送到公网搜索的敏感词次数 | 0 | Gemini 方案 |

## 5. 测试套件结构

测试工具将执行一组定义的测试用例 (`test_cases.json`)。每个测试用例包含：
- **输入提示词 (Prompt)**: 用户查询。
- **期望工具**: `private_search` (私有搜索), `public_search` (公网搜索), 或 `hybrid` (混合)。
- **期望关键词**: 答案中**必须**出现的关键短语。
- **禁止关键词**: 答案中**绝不**能出现的短语（例如幻觉或泄露的秘密）。

## 6. 执行计划
1.  **准备**: 将 `NebulaTech_Internal_Strategy_2025.txt` 加载到 Agent 的知识库中。
2.  **运行**: 遍历测试用例，向 Agent 发送提示词。
3.  **评估**:
    - 检查工具调用（如果可访问）。
    - 检查响应内容是否包含期望关键词/不包含禁止关键词。
4.  **报告**: 生成每个类别的通过/失败率摘要。
